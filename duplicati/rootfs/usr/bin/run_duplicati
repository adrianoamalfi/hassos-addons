#!/usr/bin/env bashio

USER=root

mkdir -p \
	/addons/duplicati/scripts

# update certs for mono
if [[ ! -f "/app/duplicati/donecerts" ]]; then
    bashio::log.info "*** Running mono cert sync ***"
	cert-sync --quiet /etc/ssl/certs/ca-certificates.crt
	touch "/app/duplicati/donecerts"
fi

cd /app/duplicati || exit

bashio::log.info "Starting Duplicati..."

exec s6-setuidgid ${USER:-abc} \
	mono Duplicati.Server.exe \
	--webservice-interface=any \
	--server-datafolder=/addons/duplicati \
	--webservice-allowed-hostnames=*
